<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.belocal.web.repository.ChatRepository">

    <!--보낸 회원 id가 속한 모든 채팅방 조회-->
    <select id="findAll" resultType="ChatRoomListView">
        SELECT * FROM chat_room_list_view
        WHERE traveler_id = #{memberId} OR guide_id = #{memberId};
    </select>

    <!--채팅 로그 조회-->
    <select id="chatLogFindAll" resultType="ChatLogListView">
        SELECT * FROM chat_log_list_view
        WHERE id = #{id} ORDER BY reg_date ASC ;
    </select>

    <select id="findChatRoomById" resultType="ChatRoom">
        SELECT * FROM chat_room WHERE id = #{id}
    </select>

    <insert id="addLog" parameterType="ChatLog">
        INSERT INTO chat_log
        (
            chat_room_id,
            member_id,
            message
        )
        VALUES
        (
            #{chatRoomId},
            #{memberId},
            #{message}
        )
    </insert>
</mapper>